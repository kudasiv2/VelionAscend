<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BNBVelion - Investment Platform</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0a192f 0%, #020c1b 100%);
            color: #e6f1ff;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        header {
            background: rgba(10, 25, 47, 0.95);
            padding: 15px 0;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid #64ffda;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5rem;
            font-weight: bold;
            color: #64ffda;
        }

        /* Buttons */
        .btn {
            background: linear-gradient(45deg, #00d4ff, #64ffda);
            color: #0a192f;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 212, 255, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* Sections */
        section {
            padding: 100px 0;
            min-height: 100vh;
            display: flex;
            align-items: center;
        }

        .section-title {
            text-align: center;
            margin-bottom: 50px;
        }

        .section-title h1 {
            font-size: 3rem;
            background: linear-gradient(45deg, #00d4ff, #64ffda);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
        }

        /* Box Grid */
        .box-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 30px;
            margin-bottom: 50px;
        }

        .box {
            background: rgba(2, 12, 27, 0.8);
            border: 1px solid #64ffda;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .box:hover {
            transform: translateY(-10px);
            box-shadow: 0 10px 30px rgba(100, 255, 218, 0.2);
        }

        .box i {
            font-size: 3rem;
            color: #64ffda;
            margin-bottom: 20px;
        }

        .box-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: #00d4ff;
            margin: 20px 0;
        }

        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }

        .form-control {
            width: 100%;
            padding: 15px;
            background: rgba(2, 12, 27, 0.8);
            border: 1px solid #64ffda;
            border-radius: 8px;
            color: white;
            font-size: 1rem;
        }

        .form-control:focus {
            outline: none;
            box-shadow: 0 0 10px rgba(100, 255, 218, 0.5);
        }

        /* Wallet Section */
        .wallet-section {
            text-align: center;
            margin: 40px 0;
        }

        .connected-info {
            background: rgba(2, 12, 27, 0.8);
            border: 1px solid #64ffda;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            display: inline-block;
        }

        .wallet-address {
            font-family: monospace;
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            background: #0a192f;
            border: 1px solid #64ffda;
            border-radius: 8px;
            z-index: 10000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            border-color: #64ffda;
        }

        .notification.error {
            border-color: #ff6b6b;
        }

        /* Center content */
        .center-content {
            max-width: 500px;
            margin: 0 auto;
            text-align: center;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 30px;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-coins"></i>
                    <span>BNBVelion</span>
                </div>
                <button class="btn" id="connectWallet">
                    <i class="fas fa-wallet"></i>
                    Connect Wallet
                </button>
            </div>
        </div>
    </header>

    <!-- Notification -->
    <div class="notification" id="notification"></div>

    <!-- Home Section -->
    <section id="home">
        <div class="container">
            <div class="section-title">
                <h1>BNBVelion Investment</h1>
                <p style="font-size: 1.2rem; color: #8892b0;">
                    Earn Daily ROI, Referral Commissions & Monthly Salary
                </p>
            </div>

            <div class="box-grid">
                <div class="box">
                    <i class="fas fa-chart-line"></i>
                    <h3>Total Value Locked</h3>
                    <div class="box-value" id="tvl">0 BNB</div>
                </div>
                <div class="box">
                    <i class="fas fa-users"></i>
                    <h3>Total Users</h3>
                    <div class="box-value" id="totalUsers">0</div>
                </div>
                <div class="box">
                    <i class="fas fa-wallet"></i>
                    <h3>Total Deposits</h3>
                    <div class="box-value" id="totalDeposit">0 BNB</div>
                </div>
                <div class="box">
                    <i class="fas fa-percentage"></i>
                    <h3>Current ROI</h3>
                    <div class="box-value" id="currentROI">0%</div>
                </div>
            </div>

            <div class="wallet-section">
                <div id="connectedInfo" style="display: none;">
                    <div class="connected-info">
                        <h3><i class="fas fa-check-circle"></i> Wallet Connected</h3>
                        <div class="wallet-address" id="walletAddress"></div>
                    </div>
                    <button class="btn" id="startInvesting">
                        <i class="fas fa-rocket"></i>
                        Start Investing Now
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Dashboard Section -->
    <section id="dashboard" style="background: rgba(2, 12, 27, 0.5);">
        <div class="container">
            <div class="section-title">
                <h1>Your Dashboard</h1>
                <p style="color: #8892b0;">Track your investments and earnings</p>
            </div>

            <div class="box-grid">
                <div class="box">
                    <i class="fas fa-coins"></i>
                    <h3>Your Deposit</h3>
                    <div class="box-value" id="userDeposit">0 BNB</div>
                </div>
                <div class="box">
                    <i class="fas fa-hand-holding-usd"></i>
                    <h3>Pending ROI</h3>
                    <div class="box-value" id="pendingROI">0 BNB</div>
                </div>
                <div class="box">
                    <i class="fas fa-gift"></i>
                    <h3>Referral Bonus</h3>
                    <div class="box-value" id="referralRewards">0 BNB</div>
                </div>
                <div class="box">
                    <i class="fas fa-calendar-check"></i>
                    <h3>Monthly Salary</h3>
                    <div class="box-value" id="currentSalary">0 BNB</div>
                </div>
            </div>

            <div class="action-buttons">
                <button class="btn" id="withdrawROI">
                    <i class="fas fa-download"></i>
                    Claim ROI
                </button>
                <button class="btn" id="claimReferral">
                    <i class="fas fa-gift"></i>
                    Claim Referral
                </button>
                <button class="btn" id="claimSalary">
                    <i class="fas fa-calendar-check"></i>
                    Claim Salary
                </button>
            </div>
        </div>
    </section>

    <!-- Invest Section -->
    <section id="invest">
        <div class="container">
            <div class="center-content">
                <div class="section-title">
                    <h1>Make Investment</h1>
                    <p style="color: #8892b0;">Deposit BNB to start earning</p>
                </div>

                <div class="box">
                    <h3 style="margin-bottom: 30px; color: #64ffda;">Investment Details</h3>
                    
                    <div class="form-group">
                        <label style="display: block; text-align: left; margin-bottom: 8px; color: #8892b0;">
                            Amount (BNB)
                        </label>
                        <input type="number" id="investAmount" class="form-control" 
                               placeholder="Minimum 0.01 BNB" min="0.01" step="0.01">
                    </div>

                    <div class="form-group">
                        <label style="display: block; text-align: left; margin-bottom: 8px; color: #8892b0;">
                            Referrer Address (Optional)
                        </label>
                        <input type="text" id="referrerAddress" class="form-control" 
                               placeholder="0x...">
                    </div>

                    <button class="btn" id="investNow" style="width: 100%; margin-top: 20px;">
                        <i class="fas fa-rocket"></i>
                        Invest Now
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Referral Section -->
    <section id="referral" style="background: rgba(2, 12, 27, 0.5);">
        <div class="container">
            <div class="center-content">
                <div class="section-title">
                    <h1>Referral Program</h1>
                    <p style="color: #8892b0;">Earn from 6 referral levels</p>
                </div>

                <div class="box">
                    <h3 style="margin-bottom: 20px; color: #64ffda;">Your Referral Link</h3>
                    <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                        <input type="text" id="referralLink" class="form-control" readonly>
                        <button class="btn" id="copyLink">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                    <p style="color: #8892b0; font-size: 0.9rem;">
                        Share this link and earn commissions from your referrals
                    </p>
                </div>
            </div>
        </div>
    </section>

    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
    <script>
        // Smart Contract Configuration
        const CONTRACT_ADDRESS = '0x058697328c6F1624007413E6Df6C85B468E4f6F4';
        const CONTRACT_ABI = [{"inputs":[],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"},{"indexed":true,"internalType":"address","name":"referrer","type":"address"},{"indexed":false,"internalType":"uint256","name":"fee","type":"uint256"}],"name":"Deposited","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"DirectBNBReceived","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"ROIClaimed","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"newROI","type":"uint256"}],"name":"ROIUpdated","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"ReferralBonusClaimed","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"referrer","type":"address"},{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"level","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"ReferralBonusDistributed","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"rank","type":"uint256"},{"indexed":false,"internalType":"string","name":"rankName","type":"string"}],"name":"SalaryPaid","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":true,"internalType":"address","name":"referrer","type":"address"}],"name":"UserRegistered","type":"event"},{"stateMutability":"payable","type":"fallback"},{"inputs":[],"name":"FEE_DIVIDER","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"FEE_PERCENTAGE","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"LEADER1","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"LEADER2","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"LEADER3","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"MAX_ROI","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"MAX_TVL_FOR_MAX_ROI","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"MIN_DEPOSIT","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"MIN_ROI","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"ROI_INCREMENT","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"TVL_STEP","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"claimROI","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"claimReferralBonus","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"claimSalary","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"currentROI","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_referrer","type":"address"}],"name":"deposit","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[],"name":"getContractInfo","outputs":[{"internalType":"uint256","name":"totalTVLAmount","type":"uint256"},{"internalType":"uint256","name":"currentROIPercentage","type":"uint256"},{"internalType":"uint256","name":"totalUsersCount","type":"uint256"},{"internalType":"uint256","name":"totalDepositsAmount","type":"uint256"},{"internalType":"uint256","name":"contractBalance","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"}],"name":"getPendingSalary","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"},{"internalType":"uint256","name":"_level","type":"uint256"}],"name":"getReferralCount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"}],"name":"getUserInfo","outputs":[{"internalType":"uint256","name":"totalDeposit","type":"uint256"},{"internalType":"uint256","name":"pendingROI","type":"uint256"},{"internalType":"uint256","name":"referralBonus","type":"uint256"},{"internalType":"uint256","name":"teamCount","type":"uint256"},{"internalType":"uint256","name":"salaryRank","type":"uint256"},{"internalType":"uint256","name":"daysUntilNextSalary","type":"uint256"},{"internalType":"address","name":"referrer","type":"address"},{"internalType":"bool","name":"isUserActive","type":"bool"},{"internalType":"uint256","name":"registrationTime","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"}],"name":"getUserPendingROI","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"hasDeposited","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"}],"name":"isAddressSpecialUser","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"isSpecialUser","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"manager","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"referralLevels","outputs":[{"internalType":"uint256","name":"percentage","type":"uint256"},{"internalType":"uint256","name":"minDeposit","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"salaryRanks","outputs":[{"internalType":"uint256","name":"monthlySalary","type":"uint256"},{"internalType":"uint256","name":"minTeamMembers","type":"uint256"},{"internalType":"string","name":"rankName","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalDeposits","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalTVL","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalUsers","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"},{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"}],"name":"userReferrals","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"users","outputs":[{"internalType":"uint256","name":"totalDeposit","type":"uint256"},{"internalType":"uint256","name":"lastROIUpdate","type":"uint256"},{"internalType":"uint256","name":"accumulatedROI","type":"uint256"},{"internalType":"address","name":"referrer","type":"address"},{"internalType":"uint256","name":"referralBonus","type":"uint256"},{"internalType":"uint256","name":"totalWithdrawn","type":"uint256"},{"internalType":"uint256","name":"teamCount","type":"uint256"},{"internalType":"uint256","name":"lastSalaryClaim","type":"uint256"},{"internalType":"uint256","name":"currentSalaryRank","type":"uint256"},{"internalType":"bool","name":"isActive","type":"bool"},{"internalType":"uint256","name":"registrationTime","type":"uint256"}],"stateMutability":"view","type":"function"},{"stateMutability":"payable","type":"receive"}];

        // Global Variables
        let web3;
        let contract;
        let userAccount;

        // DOM Elements
        const connectWalletBtn = document.getElementById('connectWallet');
        const startInvestingBtn = document.getElementById('startInvesting');
        const connectedInfo = document.getElementById('connectedInfo');
        const walletAddress = document.getElementById('walletAddress');
        const investNowBtn = document.getElementById('investNow');
        const withdrawROIBtn = document.getElementById('withdrawROI');
        const claimReferralBtn = document.getElementById('claimReferral');
        const claimSalaryBtn = document.getElementById('claimSalary');
        const copyLinkBtn = document.getElementById('copyLink');
        const notification = document.getElementById('notification');

        // Initialize App
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupEventListeners();
        });

        // Initialize Web3
        async function initializeApp() {
            if (typeof window.ethereum !== 'undefined') {
                try {
                    web3 = new Web3(window.ethereum);
                    contract = new web3.eth.Contract(CONTRACT_ABI, CONTRACT_ADDRESS);
                    
                    // Check if already connected
                    const accounts = await web3.eth.getAccounts();
                    if (accounts.length > 0) {
                        userAccount = accounts[0];
                        updateWalletUI();
                        loadData();
                    }
                    
                    showNotification('Web3 connected successfully!', 'success');
                } catch (error) {
                    console.error('Web3 initialization error:', error);
                    showNotification('Error connecting to blockchain', 'error');
                }
            } else {
                showNotification('Please install MetaMask!', 'error');
            }
        }

        // Setup Event Listeners
        function setupEventListeners() {
            connectWalletBtn.addEventListener('click', connectWallet);
            startInvestingBtn.addEventListener('click', () => scrollToSection('invest'));
            investNowBtn.addEventListener('click', invest);
            withdrawROIBtn.addEventListener('click', claimROI);
            claimReferralBtn.addEventListener('click', claimReferralBonus);
            claimSalaryBtn.addEventListener('click', claimSalary);
            copyLinkBtn.addEventListener('click', copyReferralLink);

            // Handle account changes
            if (window.ethereum) {
                window.ethereum.on('accountsChanged', (accounts) => {
                    if (accounts.length > 0) {
                        userAccount = accounts[0];
                        updateWalletUI();
                        loadData();
                    } else {
                        userAccount = null;
                        connectedInfo.style.display = 'none';
                        connectWalletBtn.style.display = 'block';
                    }
                });
            }
        }

        // Connect Wallet
        async function connectWallet() {
            if (!web3) {
                showNotification('Web3 not available', 'error');
                return;
            }

            try {
                const accounts = await window.ethereum.request({ 
                    method: 'eth_requestAccounts' 
                });
                
                userAccount = accounts[0];
                updateWalletUI();
                showNotification('Wallet connected!', 'success');
                loadData();
                
            } catch (error) {
                console.error('Wallet connection error:', error);
                showNotification('Failed to connect wallet', 'error');
            }
        }

        // Update Wallet UI
        function updateWalletUI() {
            connectWalletBtn.style.display = 'none';
            connectedInfo.style.display = 'block';
            
            const shortAddress = `${userAccount.substring(0, 6)}...${userAccount.substring(38)}`;
            walletAddress.textContent = shortAddress;
            
            // Update referral link
            document.getElementById('referralLink').value = 
                `${window.location.origin}?ref=${userAccount}`;
        }

        // Load All Data
        async function loadData() {
            await loadContractData();
            await loadUserData();
        }

        // Load Contract Data
        async function loadContractData() {
            if (!contract) return;

            try {
                const contractInfo = await contract.methods.getContractInfo().call();
                
                // Update TVL
                const tvlBNB = web3.utils.fromWei(contractInfo.totalTVLAmount.toString(), 'ether');
                document.getElementById('tvl').textContent = `${parseFloat(tvlBNB).toFixed(2)} BNB`;
                
                // Update total users
                document.getElementById('totalUsers').textContent = contractInfo.totalUsersCount.toString();
                
                // Update total deposit
                const totalDepositBNB = web3.utils.fromWei(contractInfo.totalDepositsAmount.toString(), 'ether');
                document.getElementById('totalDeposit').textContent = `${parseFloat(totalDepositBNB).toFixed(2)} BNB`;
                
                // Update current ROI
                const currentROI = contractInfo.currentROIPercentage;
                document.getElementById('currentROI').textContent = `${(currentROI / 100).toFixed(2)}%`;
                
            } catch (error) {
                console.error('Error loading contract data:', error);
            }
        }

        // Load User Data
        async function loadUserData() {
            if (!contract || !userAccount) return;

            try {
                const userInfo = await contract.methods.getUserInfo(userAccount).call();
                
                // Update user deposit
                const userDepositBNB = web3.utils.fromWei(userInfo.totalDeposit.toString(), 'ether');
                document.getElementById('userDeposit').textContent = `${parseFloat(userDepositBNB).toFixed(4)} BNB`;
                
                // Update pending ROI
                const pendingROI = await contract.methods.getUserPendingROI(userAccount).call();
                const pendingROIBNB = web3.utils.fromWei(pendingROI.toString(), 'ether');
                document.getElementById('pendingROI').textContent = `${parseFloat(pendingROIBNB).toFixed(4)} BNB`;
                
                // Update referral rewards
                const referralBonusBNB = web3.utils.fromWei(userInfo.referralBonus.toString(), 'ether');
                document.getElementById('referralRewards').textContent = `${parseFloat(referralBonusBNB).toFixed(4)} BNB`;
                
                // Update salary
                const pendingSalary = await contract.methods.getPendingSalary(userAccount).call();
                const pendingSalaryBNB = web3.utils.fromWei(pendingSalary.toString(), 'ether');
                document.getElementById('currentSalary').textContent = `${parseFloat(pendingSalaryBNB).toFixed(4)} BNB`;
                
            } catch (error) {
                console.error('Error loading user data:', error);
            }
        }

        // INVEST FUNCTION - SIMPLIFIED AND FIXED
        async function invest() {
            if (!contract || !userAccount) {
                showNotification('Please connect wallet first', 'error');
                return;
            }

            const amount = document.getElementById('investAmount').value;
            const referrer = document.getElementById('referrerAddress').value;

            if (!amount || amount < 0.01) {
                showNotification('Minimum 0.01 BNB required', 'error');
                return;
            }

            try {
                // Set loading state
                investNowBtn.disabled = true;
                investNowBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';

                const amountWei = web3.utils.toWei(amount, 'ether');
                
                console.log('Sending transaction:', {
                    from: userAccount,
                    value: amountWei,
                    referrer: referrer || '0x0000000000000000000000000000000000000000'
                });

                // Send transaction
                const result = await contract.methods.deposit(
                    referrer || '0x0000000000000000000000000000000000000000'
                ).send({
                    from: userAccount,
                    value: amountWei,
                    gas: 500000
                });

                console.log('Transaction successful:', result);
                
                showNotification('Investment successful! ðŸŽ‰', 'success');
                
                // Clear form
                document.getElementById('investAmount').value = '';
                document.getElementById('referrerAddress').value = '';
                
                // Reload data
                loadData();
                
            } catch (error) {
                console.error('Investment error:', error);
                
                let errorMsg = 'Investment failed';
                if (error.code === 4001) {
                    errorMsg = 'Transaction cancelled';
                } else if (error.message.includes('insufficient funds')) {
                    errorMsg = 'Insufficient BNB balance';
                } else if (error.message) {
                    errorMsg = error.message;
                }
                
                showNotification(errorMsg, 'error');
            } finally {
                // Reset button
                investNowBtn.disabled = false;
                investNowBtn.innerHTML = '<i class="fas fa-rocket"></i> Invest Now';
            }
        }

        // Claim ROI
        async function claimROI() {
            await executeTransaction(
                contract.methods.claimROI(),
                withdrawROIBtn,
                'ROI claimed successfully!',
                'Claim ROI'
            );
        }

        // Claim Referral Bonus
        async function claimReferralBonus() {
            await executeTransaction(
                contract.methods.claimReferralBonus(),
                claimReferralBtn,
                'Referral bonus claimed!',
                'Claim Referral'
            );
        }

        // Claim Salary
        async function claimSalary() {
            await executeTransaction(
                contract.methods.claimSalary(),
                claimSalaryBtn,
                'Salary claimed!',
                'Claim Salary'
            );
        }

        // Generic transaction executor
        async function executeTransaction(method, button, successMsg, buttonText) {
            if (!contract || !userAccount) {
                showNotification('Connect wallet first', 'error');
                return;
            }

            try {
                button.disabled = true;
                button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';

                await method.send({ from: userAccount, gas: 300000 });
                
                showNotification(successMsg, 'success');
                loadData();
                
            } catch (error) {
                console.error('Transaction error:', error);
                showNotification('Transaction failed', 'error');
            } finally {
                button.disabled = false;
                button.innerHTML = `<i class="fas fa-${getButtonIcon(buttonText)}"></i> ${buttonText}`;
            }
        }

        // Get button icon
        function getButtonIcon(text) {
            const icons = {
                'Claim ROI': 'download',
                'Claim Referral': 'gift',
                'Claim Salary': 'calendar-check'
            };
            return icons[text] || 'check';
        }

        // Copy Referral Link
        function copyReferralLink() {
            const link = document.getElementById('referralLink');
            link.select();
            document.execCommand('copy');
            showNotification('Link copied!', 'success');
        }

        // Scroll to section
        function scrollToSection(sectionId) {
            document.getElementById(sectionId).scrollIntoView({ 
                behavior: 'smooth' 
            });
        }

        // Show Notification
        function showNotification(message, type) {
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 5000);
        }

        // Check for referral parameter in URL
        function checkReferralParam() {
            const urlParams = new URLSearchParams(window.location.search);
            const ref = urlParams.get('ref');
            if (ref && web3?.utils.isAddress(ref)) {
                document.getElementById('referrerAddress').value = ref;
            }
        }
    </script>
</body>
</html>
