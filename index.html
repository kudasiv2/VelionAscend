<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BNBVelion - Smart Investment Platform</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --navy: #0a192f;
            --dark-navy: #020c1b;
            --cyan: #00d4ff;
            --cyan-glow: rgba(0, 212, 255, 0.7);
            --light-cyan: #64ffda;
            --white: #e6f1ff;
            --gray: #8892b0;
            --dark-gray: #495670;
            --transition: all 0.25s cubic-bezier(0.645, 0.045, 0.355, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, var(--dark-navy) 0%, var(--navy) 100%);
            color: var(--white);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header Styles */
        header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            background: rgba(10, 25, 47, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(100, 255, 218, 0.1);
            padding: 10px 0;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .logo img {
            height: 30px;
            width: auto;
        }

        .logo-text {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--white);
            text-shadow: 0 0 10px var(--cyan-glow);
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .hamburger {
            display: none;
            flex-direction: column;
            cursor: pointer;
            gap: 4px;
        }

        .hamburger span {
            width: 22px;
            height: 2px;
            background: var(--cyan);
            border-radius: 2px;
            transition: var(--transition);
        }

        /* Navigation Menu */
        .nav-menu {
            position: fixed;
            top: 52px;
            right: -100%;
            width: 80%;
            max-width: 300px;
            height: calc(100vh - 52px);
            background: var(--navy);
            flex-direction: column;
            align-items: flex-start;
            justify-content: flex-start;
            padding: 30px 20px;
            transition: var(--transition);
            border-left: 1px solid rgba(100, 255, 218, 0.1);
            z-index: 999;
            overflow-y: auto;
        }

        .nav-menu.active {
            right: 0;
        }

        .nav-link {
            display: block;
            padding: 12px 0;
            color: var(--white);
            text-decoration: none;
            font-size: 1.1rem;
            transition: var(--transition);
            border-bottom: 1px solid rgba(100, 255, 218, 0.1);
            width: 100%;
        }

        .nav-link:hover {
            color: var(--cyan);
            padding-left: 10px;
        }

        /* Section Styles */
        section {
            padding: 80px 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .section-title {
            text-align: center;
            margin-bottom: 50px;
        }

        .section-title h1 {
            font-size: 2.5rem;
            margin-bottom: 15px;
            background: linear-gradient(90deg, var(--cyan), var(--light-cyan));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 15px var(--cyan-glow);
        }

        .section-title p {
            font-size: 1.2rem;
            color: var(--gray);
            max-width: 700px;
            margin: 0 auto;
        }

        /* Box Styles */
        .box-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .box {
            background: rgba(2, 12, 27, 0.7);
            border: 1px solid rgba(100, 255, 218, 0.2);
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            transition: var(--transition);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .box:hover {
            transform: translateY(-10px);
            border-color: var(--cyan);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3), 0 0 20px var(--cyan-glow);
        }

        .box i {
            font-size: 2.5rem;
            margin-bottom: 20px;
            color: var(--cyan);
            text-shadow: 0 0 10px var(--cyan-glow);
        }

        .box h3 {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: var(--white);
        }

        .box p {
            color: var(--gray);
        }

        .box-value {
            font-size: 2rem;
            font-weight: bold;
            margin: 15px 0;
            color: var(--cyan);
            text-shadow: 0 0 10px var(--cyan-glow);
        }

        /* Button Styles - FIXED ICON ALIGNMENT */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            background: linear-gradient(90deg, var(--cyan), var(--light-cyan));
            color: var(--navy);
            border: none;
            border-radius: 5px;
            padding: 12px 24px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
            box-shadow: 0 5px 15px rgba(0, 212, 255, 0.3);
            min-width: 140px;
            height: 44px;
            line-height: 1;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 212, 255, 0.5);
        }

        .btn-secondary {
            background: transparent;
            border: 1px solid var(--cyan);
            color: var(--cyan);
        }

        .btn-secondary:hover {
            background: rgba(100, 255, 218, 0.1);
        }

        .btn-center {
            display: flex;
            justify-content: center;
            margin-top: 30px;
        }

        .btn-small {
            padding: 12px 24px;
            font-size: 1rem;
            min-width: 140px;
            height: 44px;
        }

        /* Wallet Connection */
        .wallet-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin: 30px 0;
        }

        .connected {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .connected-status {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--light-cyan);
        }

        .blinking-dot {
            width: 10px;
            height: 10px;
            background: var(--light-cyan);
            border-radius: 50%;
            animation: blink 1.5s infinite;
            box-shadow: 0 0 10px var(--light-cyan);
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .wallet-address {
            background: rgba(2, 12, 27, 0.7);
            border: 1px solid var(--cyan);
            border-radius: 5px;
            padding: 10px 15px;
            font-family: monospace;
            color: var(--white);
            font-size: 0.9rem;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--gray);
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            background: rgba(2, 12, 27, 0.7);
            border: 1px solid rgba(100, 255, 218, 0.3);
            border-radius: 5px;
            color: var(--white);
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--cyan);
            box-shadow: 0 0 10px var(--cyan-glow);
        }

        .form-control:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            background: var(--navy);
            border: 1px solid var(--cyan);
            border-radius: 5px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            z-index: 10000;
            transform: translateX(150%);
            transition: transform 0.5s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            border-color: var(--light-cyan);
        }

        .notification.error {
            border-color: #ff6b6b;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .hamburger {
                display: flex;
            }

            .section-title h1 {
                font-size: 2rem;
            }

            .section-title p {
                font-size: 1rem;
            }

            .box-grid {
                grid-template-columns: 1fr;
            }
            
            .btn, .btn-small {
                min-width: 120px;
                padding: 10px 20px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <img src="https://files.catbox.moe/itr11l.png" alt="BNBVelion Logo">
                    <div class="logo-text">BNBVelion</div>
                </div>
                <div class="nav-right">
                    <div class="hamburger" id="hamburger">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation Menu -->
    <nav class="nav-menu" id="navMenu">
        <a href="#home" class="nav-link">Home</a>
        <a href="#dashboard" class="nav-link">Dashboard</a>
        <a href="#invest" class="nav-link">Invest</a>
        <a href="#referral" class="nav-link">Referral</a>
        <a href="#salary" class="nav-link">Salary</a>
    </nav>

    <!-- Notification -->
    <div class="notification" id="notification"></div>

    <!-- Home Section -->
    <section id="home">
        <div class="container">
            <div class="section-title">
                <h1>BNBVelion Investment Platform</h1>
                <p>Earn daily ROI, referral bonuses, and monthly salaries with our secure smart contract</p>
            </div>
            
            <div class="box-grid">
                <div class="box">
                    <i class="fas fa-chart-line"></i>
                    <h3>TVL</h3>
                    <div class="box-value" id="tvl">0 BNB</div>
                    <p>Total Value Locked</p>
                </div>
                <div class="box">
                    <i class="fas fa-users"></i>
                    <h3>Total Users</h3>
                    <div class="box-value" id="totalUsers">0</div>
                    <p>Active Investors</p>
                </div>
                <div class="box">
                    <i class="fas fa-wallet"></i>
                    <h3>Total Deposit</h3>
                    <div class="box-value" id="totalDeposit">0 BNB</div>
                    <p>Total Funds Deposited</p>
                </div>
                <div class="box">
                    <i class="fas fa-money-bill-wave"></i>
                    <h3>Current ROI</h3>
                    <div class="box-value" id="currentROI">0%</div>
                    <p>Daily Return Rate</p>
                </div>
            </div>
            
            <div class="wallet-section">
                <button class="btn" id="connectWallet">
                    <i class="fas fa-plug"></i>
                    <span>Connect Wallet</span>
                </button>
                
                <div class="connected" id="connectedInfo" style="display: none;">
                    <div class="connected-status">
                        <div class="blinking-dot"></div>
                        <span>Connected</span>
                    </div>
                    <div class="wallet-address" id="walletAddress"></div>
                </div>
                
                <button class="btn" id="startInvesting" style="display: none;">
                    <i class="fas fa-rocket"></i>
                    <span>Start Investing</span>
                </button>
            </div>
        </div>
    </section>

    <!-- Dashboard Section -->
    <section id="dashboard">
        <div class="container">
            <div class="section-title">
                <h1>Your Dashboard</h1>
                <p>Monitor your investments and earnings in real-time</p>
            </div>
            
            <div class="box-grid">
                <div class="box">
                    <i class="fas fa-coins"></i>
                    <h3>Your Deposit</h3>
                    <div class="box-value" id="userDeposit">0 BNB</div>
                    <p>Total Investment</p>
                </div>
                <div class="box">
                    <i class="fas fa-hand-holding-usd"></i>
                    <h3>Pending ROI</h3>
                    <div class="box-value" id="pendingROI">0 BNB</div>
                    <p>Available for Withdrawal</p>
                </div>
                <div class="box">
                    <i class="fas fa-gift"></i>
                    <h3>Referral Bonus</h3>
                    <div class="box-value" id="referralRewards">0 BNB</div>
                    <p>Unclaimed Rewards</p>
                </div>
                <div class="box">
                    <i class="fas fa-calendar-check"></i>
                    <h3>Monthly Salary</h3>
                    <div class="box-value" id="currentSalary">0 BNB</div>
                    <p>Available Salary</p>
                </div>
            </div>
            
            <div class="btn-center">
                <button class="btn btn-small" id="withdrawROI">
                    <i class="fas fa-download"></i>
                    <span>Withdraw ROI</span>
                </button>
                <button class="btn btn-small" id="claimReferral">
                    <i class="fas fa-gift"></i>
                    <span>Claim Referral</span>
                </button>
                <button class="btn btn-small" id="claimSalary">
                    <i class="fas fa-calendar-check"></i>
                    <span>Claim Salary</span>
                </button>
            </div>
        </div>
    </section>

    <!-- Invest Section -->
    <section id="invest">
        <div class="container">
            <div class="section-title">
                <h1>Make Investment</h1>
                <p>Deposit BNB and start earning daily returns</p>
            </div>
            
            <div class="box" style="max-width: 500px; margin: 0 auto;">
                <h3 style="text-align: center; margin-bottom: 20px;">Investment Details</h3>
                <div class="form-group">
                    <label for="investAmount">Amount (BNB) - Minimum 0.01 BNB</label>
                    <input type="number" id="investAmount" class="form-control" placeholder="Enter amount" min="0.01" step="0.01">
                </div>
                <div class="form-group">
                    <label for="referrerAddress">Referrer Address (Optional)</label>
                    <input type="text" id="referrerAddress" class="form-control" placeholder="0x...">
                </div>
                <button class="btn btn-small" id="investNow" style="width: 100%; margin-top: 20px;">
                    <i class="fas fa-rocket"></i>
                    <span>Invest Now</span>
                </button>
            </div>
        </div>
    </section>

    <!-- Referral Section -->
    <section id="referral">
        <div class="container">
            <div class="section-title">
                <h1>Referral Program</h1>
                <p>Earn commissions from 6 levels of your referral network</p>
            </div>
            
            <div class="box" style="margin-bottom: 40px;">
                <h3 style="text-align: center; margin-bottom: 15px;">Your Referral Link</h3>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <input type="text" id="referralLink" class="form-control" readonly>
                    <button class="btn btn-small" id="copyLink">
                        <i class="fas fa-copy"></i>
                        <span>Copy</span>
                    </button>
                </div>
                <p style="text-align: center; margin-top: 10px; color: var(--gray); font-size: 0.9rem;">
                    Share this link to earn referral commissions
                </p>
            </div>
        </div>
    </section>

    <!-- Salary Section -->
    <section id="salary">
        <div class="container">
            <div class="section-title">
                <h1>Monthly Salary</h1>
                <p>Earn monthly salary based on your team size</p>
            </div>
            
            <div class="box">
                <h3 style="text-align: center; margin-bottom: 20px;">Salary Information</h3>
                <div style="text-align: center;">
                    <div class="box-value" id="salaryAmount">0 BNB</div>
                    <p style="margin-bottom: 20px;" id="salaryInfo">Connect wallet to view salary details</p>
                    <button class="btn btn-small" id="claimSalaryBtn">
                        <i class="fas fa-calendar-check"></i>
                        <span>Claim Salary</span>
                    </button>
                </div>
            </div>
        </div>
    </section>

    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
    <script>
        // Contract Configuration
        const CONTRACT_ADDRESS = '0x058697328c6F1624007413E6Df6C85B468E4f6F4';
        const CONTRACT_ABI = [{"inputs":[],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"},{"indexed":true,"internalType":"address","name":"referrer","type":"address"},{"indexed":false,"internalType":"uint256","name":"fee","type":"uint256"}],"name":"Deposited","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"DirectBNBReceived","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"ROIClaimed","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"newROI","type":"uint256"}],"name":"ROIUpdated","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"ReferralBonusClaimed","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"referrer","type":"address"},{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"level","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"ReferralBonusDistributed","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"rank","type":"uint256"},{"indexed":false,"internalType":"string","name":"rankName","type":"string"}],"name":"SalaryPaid","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":true,"internalType":"address","name":"referrer","type":"address"}],"name":"UserRegistered","type":"event"},{"stateMutability":"payable","type":"fallback"},{"inputs":[],"name":"FEE_DIVIDER","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"FEE_PERCENTAGE","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"LEADER1","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"LEADER2","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"LEADER3","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"MAX_ROI","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"MAX_TVL_FOR_MAX_ROI","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"MIN_DEPOSIT","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"MIN_ROI","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"ROI_INCREMENT","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"TVL_STEP","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"claimROI","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"claimReferralBonus","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"claimSalary","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"currentROI","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_referrer","type":"address"}],"name":"deposit","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[],"name":"getContractInfo","outputs":[{"internalType":"uint256","name":"totalTVLAmount","type":"uint256"},{"internalType":"uint256","name":"currentROIPercentage","type":"uint256"},{"internalType":"uint256","name":"totalUsersCount","type":"uint256"},{"internalType":"uint256","name":"totalDepositsAmount","type":"uint256"},{"internalType":"uint256","name":"contractBalance","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"}],"name":"getPendingSalary","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"},{"internalType":"uint256","name":"_level","type":"uint256"}],"name":"getReferralCount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"}],"name":"getUserInfo","outputs":[{"internalType":"uint256","name":"totalDeposit","type":"uint256"},{"internalType":"uint256","name":"pendingROI","type":"uint256"},{"internalType":"uint256","name":"referralBonus","type":"uint256"},{"internalType":"uint256","name":"teamCount","type":"uint256"},{"internalType":"uint256","name":"salaryRank","type":"uint256"},{"internalType":"uint256","name":"daysUntilNextSalary","type":"uint256"},{"internalType":"address","name":"referrer","type":"address"},{"internalType":"bool","name":"isUserActive","type":"bool"},{"internalType":"uint256","name":"registrationTime","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"}],"name":"getUserPendingROI","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"hasDeposited","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"}],"name":"isAddressSpecialUser","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"isSpecialUser","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"manager","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"referralLevels","outputs":[{"internalType":"uint256","name":"percentage","type":"uint256"},{"internalType":"uint256","name":"minDeposit","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"salaryRanks","outputs":[{"internalType":"uint256","name":"monthlySalary","type":"uint256"},{"internalType":"uint256","name":"minTeamMembers","type":"uint256"},{"internalType":"string","name":"rankName","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalDeposits","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalTVL","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalUsers","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"},{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"}],"name":"userReferrals","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"users","outputs":[{"internalType":"uint256","name":"totalDeposit","type":"uint256"},{"internalType":"uint256","name":"lastROIUpdate","type":"uint256"},{"internalType":"uint256","name":"accumulatedROI","type":"uint256"},{"internalType":"address","name":"referrer","type":"address"},{"internalType":"uint256","name":"referralBonus","type":"uint256"},{"internalType":"uint256","name":"totalWithdrawn","type":"uint256"},{"internalType":"uint256","name":"teamCount","type":"uint256"},{"internalType":"uint256","name":"lastSalaryClaim","type":"uint256"},{"internalType":"uint256","name":"currentSalaryRank","type":"uint256"},{"internalType":"bool","name":"isActive","type":"bool"},{"internalType":"uint256","name":"registrationTime","type":"uint256"}],"stateMutability":"view","type":"function"},{"stateMutability":"payable","type":"receive"}];

        // Global Variables
        let web3;
        let contract;
        let userAccount;

        // DOM Elements
        const connectWalletBtn = document.getElementById('connectWallet');
        const startInvestingBtn = document.getElementById('startInvesting');
        const connectedInfo = document.getElementById('connectedInfo');
        const walletAddress = document.getElementById('walletAddress');
        const investNowBtn = document.getElementById('investNow');
        const withdrawROIBtn = document.getElementById('withdrawROI');
        const claimReferralBtn = document.getElementById('claimReferral');
        const claimSalaryBtn = document.getElementById('claimSalary');
        const copyLinkBtn = document.getElementById('copyLink');
        const notification = document.getElementById('notification');
        const hamburger = document.getElementById('hamburger');
        const navMenu = document.getElementById('navMenu');

        // Initialize App
        document.addEventListener('DOMContentLoaded', function() {
            initApp();
            setupEventListeners();
            checkURLForReferral();
        });

        // Initialize Web3 and Contract
        async function initApp() {
            if (typeof window.ethereum !== 'undefined') {
                try {
                    web3 = new Web3(window.ethereum);
                    contract = new web3.eth.Contract(CONTRACT_ABI, CONTRACT_ADDRESS);
                    
                    // Check if already connected
                    const accounts = await window.ethereum.request({ method: 'eth_accounts' });
                    if (accounts.length > 0) {
                        userAccount = accounts[0];
                        updateWalletUI();
                        loadContractData();
                        loadUserData();
                    }
                    
                    console.log('Web3 initialized successfully');
                } catch (error) {
                    console.error('Error initializing Web3:', error);
                    showNotification('Error connecting to blockchain', 'error');
                }
            } else {
                showNotification('Please install MetaMask to use this dApp', 'error');
            }
        }

        // Setup Event Listeners
        function setupEventListeners() {
            // Wallet Connection
            connectWalletBtn.addEventListener('click', connectWallet);
            startInvestingBtn.addEventListener('click', () => {
                document.getElementById('invest').scrollIntoView({ behavior: 'smooth' });
            });

            // Investment
            investNowBtn.addEventListener('click', invest);

            // Claims
            withdrawROIBtn.addEventListener('click', claimROI);
            claimReferralBtn.addEventListener('click', claimReferralBonus);
            claimSalaryBtn.addEventListener('click', claimSalary);

            // Referral
            copyLinkBtn.addEventListener('click', copyReferralLink);

            // Navigation
            hamburger.addEventListener('click', toggleNavMenu);
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', () => {
                    navMenu.classList.remove('active');
                });
            });

            // Account Changes
            if (window.ethereum) {
                window.ethereum.on('accountsChanged', handleAccountsChanged);
                window.ethereum.on('chainChanged', () => window.location.reload());
            }
        }

        // Handle Account Changes
        function handleAccountsChanged(accounts) {
            if (accounts.length === 0) {
                userAccount = null;
                connectWalletBtn.style.display = 'block';
                connectedInfo.style.display = 'none';
                startInvestingBtn.style.display = 'none';
            } else {
                userAccount = accounts[0];
                updateWalletUI();
                loadContractData();
                loadUserData();
            }
        }

        // Connect Wallet
        async function connectWallet() {
            if (!web3) {
                showNotification('Web3 not initialized', 'error');
                return;
            }

            try {
                const accounts = await window.ethereum.request({ 
                    method: 'eth_requestAccounts' 
                });
                
                userAccount = accounts[0];
                updateWalletUI();
                showNotification('Wallet connected successfully!', 'success');
                
                loadContractData();
                loadUserData();
                
            } catch (error) {
                console.error('Error connecting wallet:', error);
                showNotification('Failed to connect wallet', 'error');
            }
        }

        // Update Wallet UI
        function updateWalletUI() {
            connectWalletBtn.style.display = 'none';
            connectedInfo.style.display = 'flex';
            startInvestingBtn.style.display = 'inline-flex';
            
            const shortAddress = `${userAccount.substring(0, 6)}...${userAccount.substring(userAccount.length - 4)}`;
            walletAddress.textContent = shortAddress;
            
            // Update referral link
            document.getElementById('referralLink').value = 
                `${window.location.origin}${window.location.pathname}?ref=${userAccount}`;
        }

        // Load Contract Data
        async function loadContractData() {
            if (!contract) return;

            try {
                const contractInfo = await contract.methods.getContractInfo().call();
                
                // Update TVL
                const tvlBNB = web3.utils.fromWei(contractInfo.totalTVLAmount.toString(), 'ether');
                document.getElementById('tvl').textContent = `${parseFloat(tvlBNB).toFixed(2)} BNB`;
                
                // Update total users
                document.getElementById('totalUsers').textContent = contractInfo.totalUsersCount.toString();
                
                // Update total deposit
                const totalDepositBNB = web3.utils.fromWei(contractInfo.totalDepositsAmount.toString(), 'ether');
                document.getElementById('totalDeposit').textContent = `${parseFloat(totalDepositBNB).toFixed(2)} BNB`;
                
                // Update current ROI
                const currentROI = contractInfo.currentROIPercentage;
                document.getElementById('currentROI').textContent = `${(currentROI / 100).toFixed(2)}%`;
                
            } catch (error) {
                console.error('Error loading contract data:', error);
            }
        }

        // Load User Data
        async function loadUserData() {
            if (!contract || !userAccount) return;

            try {
                const userInfo = await contract.methods.getUserInfo(userAccount).call();
                
                // Update user deposit
                const userDepositBNB = web3.utils.fromWei(userInfo.totalDeposit.toString(), 'ether');
                document.getElementById('userDeposit').textContent = `${parseFloat(userDepositBNB).toFixed(4)} BNB`;
                
                // Update pending ROI
                const pendingROI = await contract.methods.getUserPendingROI(userAccount).call();
                const pendingROIBNB = web3.utils.fromWei(pendingROI.toString(), 'ether');
                document.getElementById('pendingROI').textContent = `${parseFloat(pendingROIBNB).toFixed(4)} BNB`;
                
                // Update referral rewards
                const referralBonusBNB = web3.utils.fromWei(userInfo.referralBonus.toString(), 'ether');
                document.getElementById('referralRewards').textContent = `${parseFloat(referralBonusBNB).toFixed(4)} BNB`;
                
                // Update salary
                const pendingSalary = await contract.methods.getPendingSalary(userAccount).call();
                const pendingSalaryBNB = web3.utils.fromWei(pendingSalary.toString(), 'ether');
                document.getElementById('currentSalary').textContent = `${parseFloat(pendingSalaryBNB).toFixed(4)} BNB`;
                
            } catch (error) {
                console.error('Error loading user data:', error);
            }
        }

        // INVEST FUNCTION - FIXED
        async function invest() {
            if (!contract || !userAccount) {
                showNotification('Please connect your wallet first', 'error');
                return;
            }

            const amount = document.getElementById('investAmount').value;
            const referrerAddress = document.getElementById('referrerAddress').value;

            if (!amount || amount < 0.01) {
                showNotification('Minimum investment is 0.01 BNB', 'error');
                return;
            }

            try {
                // Show loading state
                investNowBtn.disabled = true;
                investNowBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';

                // Convert amount to wei
                const amountWei = web3.utils.toWei(amount, 'ether');
                
                // Determine referrer address
                let referrer = referrerAddress;
                if (!referrer || !web3.utils.isAddress(referrer)) {
                    // Use contract owner as default referrer if none provided
                    referrer = await contract.methods.owner().call();
                }

                console.log('Investing:', {
                    amount: amount,
                    amountWei: amountWei,
                    referrer: referrer,
                    from: userAccount
                });

                // Execute deposit transaction
                const transaction = await contract.methods.deposit(referrer).send({
                    from: userAccount,
                    value: amountWei,
                    gas: 300000 // Adequate gas limit
                });

                console.log('Transaction successful:', transaction);
                
                showNotification('Investment successful!', 'success');
                
                // Reset form
                document.getElementById('investAmount').value = '';
                document.getElementById('referrerAddress').value = '';
                
                // Reload data
                loadContractData();
                loadUserData();
                
            } catch (error) {
                console.error('Investment error:', error);
                let errorMessage = 'Investment failed';
                
                if (error.code === 4001) {
                    errorMessage = 'Transaction rejected by user';
                } else if (error.message) {
                    errorMessage = error.message;
                }
                
                showNotification(errorMessage, 'error');
            } finally {
                // Reset button state
                investNowBtn.disabled = false;
                investNowBtn.innerHTML = '<i class="fas fa-rocket"></i> Invest Now';
            }
        }

        // Claim ROI
        async function claimROI() {
            if (!contract || !userAccount) {
                showNotification('Please connect your wallet first', 'error');
                return;
            }

            try {
                withdrawROIBtn.disabled = true;
                withdrawROIBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';

                await contract.methods.claimROI().send({ from: userAccount });
                showNotification('ROI claimed successfully!', 'success');
                
                loadUserData();
                
            } catch (error) {
                console.error('Error claiming ROI:', error);
                showNotification('Failed to claim ROI', 'error');
            } finally {
                withdrawROIBtn.disabled = false;
                withdrawROIBtn.innerHTML = '<i class="fas fa-download"></i> Withdraw ROI';
            }
        }

        // Claim Referral Bonus
        async function claimReferralBonus() {
            if (!contract || !userAccount) {
                showNotification('Please connect your wallet first', 'error');
                return;
            }

            try {
                claimReferralBtn.disabled = true;
                claimReferralBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';

                await contract.methods.claimReferralBonus().send({ from: userAccount });
                showNotification('Referral bonus claimed successfully!', 'success');
                
                loadUserData();
                
            } catch (error) {
                console.error('Error claiming referral bonus:', error);
                showNotification('Failed to claim referral bonus', 'error');
            } finally {
                claimReferralBtn.disabled = false;
                claimReferralBtn.innerHTML = '<i class="fas fa-gift"></i> Claim Referral';
            }
        }

        // Claim Salary
        async function claimSalary() {
            if (!contract || !userAccount) {
                showNotification('Please connect your wallet first', 'error');
                return;
            }

            try {
                claimSalaryBtn.disabled = true;
                claimSalaryBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';

                await contract.methods.claimSalary().send({ from: userAccount });
                showNotification('Salary claimed successfully!', 'success');
                
                loadUserData();
                
            } catch (error) {
                console.error('Error claiming salary:', error);
                showNotification('Failed to claim salary', 'error');
            } finally {
                claimSalaryBtn.disabled = false;
                claimSalaryBtn.innerHTML = '<i class="fas fa-calendar-check"></i> Claim Salary';
            }
        }

        // Copy Referral Link
        function copyReferralLink() {
            const referralLink = document.getElementById('referralLink');
            referralLink.select();
            document.execCommand('copy');
            showNotification('Referral link copied to clipboard!', 'success');
        }

        // Check URL for Referral Parameter
        function checkURLForReferral() {
            const urlParams = new URLSearchParams(window.location.search);
            const refAddress = urlParams.get('ref');
            
            if (refAddress && web3?.utils.isAddress(refAddress)) {
                document.getElementById('referrerAddress').value = refAddress;
            }
        }

        // Show Notification
        function showNotification(message, type) {
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 5000);
        }

        // Toggle Navigation Menu
        function toggleNavMenu() {
            navMenu.classList.toggle('active');
        }
    </script>
</body>
</html>
